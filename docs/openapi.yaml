openapi: 3.0.3
info:
  title: PDF Generator Microservice
  description: |
    A microservice that generates customized PDFs based on user and session information.
    The PDF format remains consistent, but fields are populated with user-specific data.
  version: 1.0.0
  contact:
    name: API Support
    email: support@pdfgenerator.com

servers:
  - url: http://localhost:8080/v1
    description: Local development

paths:
  /generate-pdf:
    get:
      summary: Generate a customized PDF document
      description: |
        Generates a PDF based on the provided session ID and user ID.
        The PDF structure remains consistent but specific fields are populated with user data.
      operationId: generatePdf
      parameters:
        - name: sessionId
          in: query
          required: true
          description: Unique identifier for the user's current session
          schema:
            type: string
            example: "sess_a1b2c3d4e5f6"
        - name: userId
          in: query
          required: true
          description: Unique identifier for the user
          schema:
            type: string
            example: "user_123456789"
        - name: responseType
          in: query
          required: false
          description: |
            How the PDF should be returned to the client.
            - 'stream' (default): Direct download as binary stream
            - 'json': JSON response with URL or base64 content
          schema:
            type: string
            enum: [stream, json]
            default: stream
      responses:
        '200':
          description: PDF successfully generated
          content:
            application/pdf:
              schema:
                type: string
                format: binary
              examples:
                binaryPdfExample:
                  summary: Binary PDF file
                  description: A binary PDF file returned directly to the client for download
            application/json:
              schema:
                $ref: '#/components/schemas/PdfResponse'
              examples:
                jsonResponseExample:
                  summary: JSON response with PDF data
                  value:
                    success: true
                    message: "PDF generated successfully"
                    data:
                      documentId: "doc_7890abcdef"
                      fileName: "user_123456789_report.pdf"
                      downloadUrl: "https://api.example.com/v1/documents/doc_7890abcdef/download"
                      expiresAt: "2025-08-09T04:13:57Z"
                      contentBase64: "JVBERi0xLjYKJcOkw7zDtsOfCjIgMCBvYmoKPDwvTGVuZ3RoIDMgMCBSL0Zp..."
        '400':
          description: Bad request - missing or invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Missing or invalid parameters"
                errors:
                  - field: "sessionId"
                    message: "Session ID is required"
        '401':
          description: Unauthorized - invalid credentials or expired session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Unauthorized access"
                errors:
                  - message: "Session expired or invalid"
        '404':
          description: User not found or template not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Resource not found"
                errors:
                  - message: "User ID not found in the system"
        '500':
          description: Internal server error during PDF generation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "PDF generation failed"
                errors:
                  - message: "Internal server error while generating PDF"
                  - message: "Please try again later or contact support"


components:
  schemas:
    PdfResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the operation was successful
        message:
          type: string
          description: Human-readable status message
        data:
          type: object
          properties:
            documentId:
              type: string
              description: Unique identifier for the generated document
            fileName:
              type: string
              description: Suggested filename for the PDF
            downloadUrl:
              type: string
              description: URL to download the generated PDF
            expiresAt:
              type: string
              format: date-time
              description: When the download URL expires
            contentBase64:
              type: string
              description: Base64 encoded PDF content (only included when explicitly requested)
          required:
            - documentId
            - fileName
            - downloadUrl
            - expiresAt
      required:
        - success
        - message
        - data
    
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Always false for error responses
        message:
          type: string
          description: Summary of the error
        errors:
          type: array
          description: Detailed error information
          items:
            type: object
            properties:
              field:
                type: string
                description: The specific field that caused the error (if applicable)
              message:
                type: string
                description: Detailed error message
            required:
              - message
      required:
        - success
        - message
        - errors

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - ApiKeyAuth: []
  - BearerAuth: []